; Each PHP flavour (base, mods, prod, work) might have its own php.ini.
; If none is present, the one from the previous flavour is inherited.


[PHP]

; Memory
; Note: "memory_limit" should be larger than "post_max_size"
memory_limit            = 4g

; Error reporting
; Note: error_log is dynamic and handled during start to set appropriate setting
; Exclude deprecated warnings, notices, and INFO-level messages
error_reporting         = E_ALL & ~E_NOTICE & ~E_STRICT & ~E_DEPRECATED & ~E_WARNING
xmlrpc_errors           = Off
report_memleaks         = On
display_errors          = Off
display_startup_errors  = Off
log_errors              = On
html_errors             = On

; Logging controls - disable INFO level messages
; Prevent deprecation warnings from third-party libraries from appearing in logs
log_errors_max_len      = 0
ignore_repeated_errors  = On
ignore_repeated_source  = On

date.timezone=UTC

; Xdebug Configuration for PHP 8.4
[xdebug]
; Enable Xdebug only when needed (disable by default to improve performance)
; Set XDEBUG_MODE=debug in your .env file to enable debugging
xdebug.mode=off

; Client connection settings
xdebug.client_host=host.docker.internal
xdebug.client_port=9003

; Start debugging on request (not automatically) to avoid connection warnings
xdebug.start_with_request=trigger

; IDE key for debugging sessions
xdebug.idekey=PHPSTORM

; Connection discovery
xdebug.discover_client_host=false

; Logging (uncomment for debugging connection issues)
; xdebug.log=/tmp/xdebug.log
; xdebug.log_level=7

; OPcache Configuration for PHP 8.4
[opcache]
; Enable OPcache
opcache.enable=1
opcache.enable_cli=0

; Memory configuration (256MB shared memory)
opcache.memory_consumption=256
opcache.interned_strings_buffer=32
opcache.max_accelerated_files=30000

; Revalidation (disable in production for max performance)
; Set to 0 in production, 2 in development
opcache.validate_timestamps=1
opcache.revalidate_freq=2

; File cache (for container restarts)
opcache.file_cache=/tmp/opcache
opcache.file_cache_only=0
opcache.file_cache_consistency_checks=1

; JIT Configuration (PHP 8.4 improvements)
; "tracing" = best for long-running scripts (FPM)
; "function" = best for CLI/short scripts
opcache.jit=tracing
; JIT buffer size (128MB - 25% of opcache memory is recommended)
opcache.jit_buffer_size=128M
; JIT optimization level (max=1255)
opcache.jit_max_root_traces=1024
opcache.jit_max_side_traces=256

; Performance tuning
opcache.optimization_level=0x7FFEBFFF
opcache.huge_code_pages=0
opcache.save_comments=1
opcache.fast_shutdown=1

; Preloading (uncomment and configure for production)
; opcache.preload=/app/config/preload.php
; opcache.preload_user=app

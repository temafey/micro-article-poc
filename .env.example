###> symfony/framework-bundle ###
APP_COMPANY_NAME=test
APP_PROJECT_NAME=Micro
APP_SERVICE_NAME=article
APP_ACL_NAME=acl
APP_ENV=dev
APP_SECRET=
APP_VERSION=1.0.0
APP_DEBUG=true
###> symfony/framework-bundle ###

###> common variables ###
DOCKER_PHP_VERSION=8.4
DOCKER_NETWORK_NAME=test_article_net
DOCKER_SERVER_HOST=docker.local
DOCKER_IMAGE_VERSION=master
DOCKER_PROJECT_PATH=test-micro-article-system
CI_SERVICE_NAME=test-micro-article-system
DOCKER_PHP_CONTAINER_NAME=test-micro-article-system-rest
###< common variables ###

###> postgresql ###
APP_DATABASE_HOST=test-micro-article-system-database
APP_DATABASE_PORT=5432
APP_DATABASE_EXT_PORT=5435
APP_DATABASE_NAME=micro-article-system

# Root/Admin user - FULL PRIVILEGES (for migrations, schema changes)
# Use this for: doctrine:migrations:migrate, doctrine:schema:update
APP_DATABASE_ROOT_LOGIN=postgres
APP_DATABASE_ROOT_PASSWORD=postgres

# Service user - RESTRICTED PRIVILEGES (for application runtime)
# Can only: SELECT, INSERT, UPDATE, DELETE
# Cannot: CREATE, ALTER, DROP, TRUNCATE (no schema modifications)
APP_DATABASE_SERVICE_LOGIN=article_service
APP_DATABASE_SERVICE_PASSWORD=article_service_secure_pwd_2024

# Default connection uses service user (principle of least privilege)
APP_DATABASE_LOGIN=${APP_DATABASE_SERVICE_LOGIN}
APP_DATABASE_PASSWORD=${APP_DATABASE_SERVICE_PASSWORD}
###< postgresql ###

###> nelmio/cors-bundle ###
APP_CORS_ALLOW_ORIGIN=*
###< nelmio/cors-bundle ###


###> doctrine/doctrine-bundle ###
# NOTE: DATABASE_URL is NOT used in this project.
# Database connection is configured via individual APP_DATABASE_* variables
# in config/packages/doctrine.yaml (see default and migration connections).
#
# The following is kept for reference only:
# DATABASE_URL="postgresql://${APP_DATABASE_SERVICE_LOGIN}:${APP_DATABASE_SERVICE_PASSWORD}@${APP_DATABASE_HOST}:${APP_DATABASE_PORT}/${APP_DATABASE_NAME}?serverVersion=18&charset=utf8"
###< doctrine/doctrine-bundle ###

###> RabbitMQ credentials ###
APP_RABBITMQ_HOST=test-micro-article-system-rabbitmq
APP_RABBITMQ_PORT=5672
APP_RABBITMQ_EXT_PORT=5673
APP_RABBITMQ_ADMIN_EXT_PORT=15673
APP_RABBITMQ_ADMIN_PORT=15672
APP_RABBITMQ_VHOST=vhost
APP_RABBITMQ_USER=guest
APP_RABBITMQ_PASS=guest
APP_RABBITMQ_API_PORT=15672
APP_QUEUE_HOST=test-micro-article-system-rabbitmq
APP_QUEUE_PORT=5672
###< RabbitMQ credentials ###

###> redis ###
APP_REDIS_HOST=test-micro-article-system-redis
APP_REDIS_PORT=6379
APP_REDIS_EXT_PORT=6379
###< redis ###

###> security ###
# Stateless CSRF Protection (Symfony 8.0+)
# Set to true for browser-based clients, false for pure API services
CSRF_PROTECTION_ENABLED=false

# Message Signing (HMAC-SHA256)
# Secret key for signing messages (uses APP_SECRET if not set)
# MESSAGE_SIGNING_SECRET=
# Message lifetime in seconds (default: 300 = 5 minutes)
MESSAGE_LIFETIME=300
# Whether to require signatures on SignedMessageInterface commands
MESSAGE_REQUIRE_SIGNATURE=false
###< security ###

###> php-8.4 ###
# OPcache Configuration (PHP 8.4)
# JIT modes: off, tracing (FPM), function (CLI)
# Set to "off" when using Xdebug for debugging
PHP_OPCACHE_JIT=off
PHP_OPCACHE_JIT_BUFFER_SIZE=128M
PHP_OPCACHE_MEMORY_CONSUMPTION=256
PHP_OPCACHE_VALIDATE_TIMESTAMPS=1
PHP_OPCACHE_REVALIDATE_FREQ=2

# Xdebug Configuration
# Modes: off, debug, coverage, profile, trace
XDEBUG_MODE=off

# CLI Container Xdebug (PHPStorm Integration)
# The CLI container uses a separate Xdebug mode for debugging scripts
# Default: debug (auto-starts debugging for all CLI scripts)
# Set to "off" to disable CLI debugging, "coverage" for code coverage
XDEBUG_CLI_MODE=debug
###< php-8.4 ###

PHP_IDE_CONFIG=serverName=localhost

###> opentelemetry ###
# Enable/disable OpenTelemetry instrumentation globally
OTEL_ENABLED=true

# Service identification
OTEL_SERVICE_NAME=article-microservice
OTEL_SERVICE_VERSION=1.0.0
OTEL_SERVICE_NAMESPACE=micro

# Resource attributes (additional metadata for telemetry)
OTEL_RESOURCE_ATTRIBUTES=deployment.environment=development,service.instance.id=${HOSTNAME:-local}

# OTLP Exporter Configuration
# For development: use grafana/otel-lgtm container
# For production: use dedicated Grafana Alloy or OTEL Collector
OTEL_EXPORTER_OTLP_ENDPOINT=http://test-otel-lgtm:4318
OTEL_EXPORTER_OTLP_PROTOCOL=http/protobuf

# Exporter selection (otlp, console, none)
OTEL_TRACES_EXPORTER=otlp
OTEL_METRICS_EXPORTER=otlp
OTEL_LOGS_EXPORTER=otlp

# PHP OpenTelemetry Auto-Instrumentation
OTEL_PHP_AUTOLOAD_ENABLED=true

# Trace sampling (1.0 = 100%, 0.1 = 10%)
OTEL_TRACES_SAMPLER=parentbased_always_on
OTEL_TRACES_SAMPLER_ARG=1.0

# Propagation format (W3C TraceContext is standard)
OTEL_PROPAGATORS=tracecontext,baggage

# Log level for OTel SDK internals (debug, info, warning, error)
OTEL_LOG_LEVEL=warning
###< opentelemetry ###

###> opentelemetry circuit breaker (Phase 15) ###
# Circuit Breaker Configuration (TASK-15: OpenTelemetry Resilience)
# Prevents request blocking when OTEL collector is unavailable
OTEL_CIRCUIT_BREAKER_ENABLED=true
# Time window for measuring failure rate (seconds)
OTEL_CB_TIME_WINDOW=30
# Failure rate threshold to trip circuit (percentage, 0-100)
OTEL_CB_FAILURE_RATE=50
# Minimum requests before circuit can trip
OTEL_CB_MIN_REQUESTS=3
# Time before testing if service recovered (seconds)
OTEL_CB_HALF_OPEN_INTERVAL=10
###< opentelemetry circuit breaker ###

###> observability stack ###
# Stack selection (otel-lgtm | legacy)
# - otel-lgtm: Modern OpenTelemetry stack with grafana/otel-lgtm (recommended)
#              Includes: Loki (logs), Tempo (traces), Mimir (metrics), Grafana UI
# - legacy: Traditional stack (Jaeger, Prometheus, etc.) - for backwards compatibility
# See: docs/adr/ADR-014-observability-stack-modernization.md
OBSERVABILITY_STACK=otel-lgtm

# Container naming
APP_OTEL_LGTM_NAME=test-otel-lgtm

# Grafana UI
APP_GRAFANA_PORT=3000
APP_GRAFANA_EXT_PORT=3000
APP_GRAFANA_ADMIN_USER=admin
APP_GRAFANA_ADMIN_PASSWORD=admin

# OTLP gRPC receiver
APP_OTLP_GRPC_PORT=4317
APP_OTLP_GRPC_EXT_PORT=4317

# OTLP HTTP receiver
APP_OTLP_HTTP_PORT=4318
APP_OTLP_HTTP_EXT_PORT=4318
###< observability stack ports ###

###> pyroscope continuous profiling (ADR-014 Phase 4.2) ###
# Enable/disable continuous profiling
PYROSCOPE_ENABLED=true

# Pyroscope server URL (part of observability stack)
PYROSCOPE_SERVER_URL=http://test-pyroscope:4040

# Sample rate in Hz (samples per second, default: 100)
PYROSCOPE_SAMPLE_RATE=100

# Upload interval in seconds (how often to flush profiles, default: 10)
PYROSCOPE_UPLOAD_INTERVAL=10
###< pyroscope continuous profiling ###

###> transactional outbox pattern (Phase 14) ###
# Enable/disable outbox pattern for events (domain events via EventStore)
OUTBOX_ENABLED=true

# Enable/disable outbox pattern for task commands (via TaskProducer)
OUTBOX_TASK_ENABLED=true

# Topic prefix for outbox event publishing (e.g., 'events.article.created')
OUTBOX_EVENT_TOPIC_PREFIX=events.

# Routing key prefix for outbox event routing (e.g., 'event.article.created')
OUTBOX_ROUTING_KEY_PREFIX=event.

# Batch size for outbox publisher (number of entries per publish cycle)
OUTBOX_PUBLISH_BATCH_SIZE=100

# Cleanup retention period in days (entries older than this are deleted)
OUTBOX_CLEANUP_RETENTION_DAYS=7
###< transactional outbox pattern ###


